<html><head><title>Mind Reader</title>
<style>
@keyframes fadeInFlicker {
  0% { opacity: 0; text-shadow: none; }
  30% { opacity: 0.3; }
  60% { opacity: 0.6; text-shadow: 0 0 8px white; }
  100% { opacity: 1; text-shadow: 0 0 12px white; }
}

#liveThought span {
  display: inline-block;
  opacity: 0;
  animation: fadeInFlicker 1.2s ease forwards;
}
</style>

</head><body>



<script>
let recognition;
window.addEventListener("load", () => {
  if ('webkitSpeechRecognition' in window) {
    recognition = new webkitSpeechRecognition();
    recognition.lang = "en-US";
    recognition.continuous = true;
    recognition.interimResults = true;
    recognition.onresult = (event) => {
      let live = "";
      for (let i = event.resultIndex; i < event.results.length; ++i) {
        if (event.results[i].isFinal) {
          live += event.results[i][0].transcript + " ";
        }
      }
      document.getElementById("liveThought").innerText = live.trim();
      localStorage.setItem("lastVoice", live.trim());
    };
    recognition.onerror = (event) => {
      console.warn("Mic error:", event.error);
    };
    recognition.start();
  }
});

window.addEventListener("beforeunload", () => {
  if (recognition && recognition.stop) recognition.stop();
});
</script>


<script>
function animateLiveThought(text) {
  const container = document.getElementById("liveThought");
  container.innerHTML = "";
  const words = text.split(" ");
  words.forEach((word, i) => {
    const span = document.createElement("span");
    span.textContent = word + " ";
    span.style.animationDelay = `${i * 0.25}s`;
    container.appendChild(span);
  });
}

if (recognition) {
  recognition.onresult = (event) => {
    let finalPhrase = "";
    for (let i = event.resultIndex; i < event.results.length; ++i) {
      if (event.results[i].isFinal) {
        finalPhrase += event.results[i][0].transcript + " ";
      }
    }
    finalPhrase = finalPhrase.trim();
    if (finalPhrase.length > 0) {
      localStorage.setItem("lastVoice", finalPhrase);
      animateLiveThought(finalPhrase);
    }
  };
}
</script>


<style>
.card-container {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 5;
}
.card-container img {
  display: none;
  width: 300px;
  height: auto;
  border-radius: 12px;
  box-shadow: 0 0 18px rgba(0,0,0,0.6);
}
.card-container img.active {
  display: block;
}
</style>

<div class="card-container" id="cardDisplay">
  <!-- Card images will be preloaded here -->
</div>

<script>
const cardNames = [
  "ace_of_clubs", "2_of_clubs", "3_of_clubs", "4_of_clubs", "5_of_clubs", "6_of_clubs", "7_of_clubs", "8_of_clubs", "9_of_clubs", "10_of_clubs", "jack_of_clubs", "queen_of_clubs", "king_of_clubs",
  "ace_of_diamonds", "2_of_diamonds", "3_of_diamonds", "4_of_diamonds", "5_of_diamonds", "6_of_diamonds", "7_of_diamonds", "8_of_diamonds", "9_of_diamonds", "10_of_diamonds", "jack_of_diamonds", "queen_of_diamonds", "king_of_diamonds",
  "ace_of_hearts", "2_of_hearts", "3_of_hearts", "4_of_hearts", "5_of_hearts", "6_of_hearts", "7_of_hearts", "8_of_hearts", "9_of_hearts", "10_of_hearts", "jack_of_hearts", "queen_of_hearts", "king_of_hearts",
  "ace_of_spades", "2_of_spades", "3_of_spades", "4_of_spades", "5_of_spades", "6_of_spades", "7_of_spades", "8_of_spades", "9_of_spades", "10_of_spades", "jack_of_spades", "queen_of_spades", "king_of_spades"
];

// Preload all card images
const cardContainer = document.getElementById("cardDisplay");
cardNames.forEach(card => {
  const img = document.createElement("img");
  img.src = `/images/cards/${card}.png`;
  img.id = card;
  cardContainer.appendChild(img);
});

// Normalize spoken text to match card filename
function normalizeCardName(text) {
  text = text.toLowerCase().replace(" of ", "_of_").replace(" ", "_");
  return cardNames.find(c => text.includes(c));
}

// Listen for mic input and update card
if (recognition) {
  recognition.onresult = (event) => {
    let finalPhrase = "";
    for (let i = event.resultIndex; i < event.results.length; ++i) {
      if (event.results[i].isFinal) {
        finalPhrase += event.results[i][0].transcript + " ";
      }
    }
    finalPhrase = finalPhrase.trim();
    const matched = normalizeCardName(finalPhrase);
    if (matched) {
      document.querySelectorAll(".card-container img").forEach(img => img.classList.remove("active"));
      const cardImg = document.getElementById(matched);
      if (cardImg) {
        cardImg.classList.add("active");
        localStorage.setItem("lastCard", matched);
      }
    }
  };
}
</script>

</body></html>